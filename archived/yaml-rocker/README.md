# Deprecation warning
You should use [k8s-rocker](../k8s-rocker) as it's kubernetes native and has many more features.

# YAML Rocker
Because Openshift is extremely complicated.

# State of the project
This helm chart is primarly for use together with openshift.
Kubernetes support is not here yet but planned.

# Values

## Required & defaults
```yaml
app: my-app
name: my-name

image: alpine
tag: latest

cpu:
  min: 100m
  max: 1000m
memory:
  min: 500Mi
  max: 550Mi
```
## Optional Values

EVERYTHING below is optional

### Version
You can specify the version of the deployment. This is helpful for CI jobs.
```yaml
version: 0.0.1
```
### Replicas
Configures the amount of replicas. Usefull in combination with stateful sets.
```yaml
replicas: 1
```
### Autoscaling
Configures autoscaling
```yaml
autoscale:
  min: 1 # minimum pods
  max: 4 # maximum pods
  percentage: 100 # cpu usage in **openshift madness**. defaults to 80
```
### Routes
Don't forget to also specify a port if you use this.
```yaml
routes:
  first-route:
    host: my.host.domain.cloud
    path: /the/path # optional
    port: my-port # the 'name' of the port of the service or a port
    service: my-service # optional
    termination: edge # optional accepts anything you write here, be careful
    annotations: # optional annotations
      awesome/annotation: true
  second-route:
    host: my.other.host.domain.cloud
    port: my-port
```
### Port forwarding
```yaml
ports:
  my-port: # 'name' of the port
    port: 100
    target: 100 # defaults to port
```
### Volumes
```yaml
volumes:
  my-volume:
    path: /path/to/mount
    readonly: false
    subPath: sub/path/inside/volume # optional
    acccessMode: ReadWriteOnce # optional
    storage: 1Gi
    annotations:
      my-annotation: my-value
```

### Environment Variables
```yaml
env:
  my-env-variable: my-env-variable-value
  other-env-variable: my-env-variable-value
```
#### Raw Environment Variables
Allows to specify a raw value for environment variables in openshift yaml format.
This is usefull to map various metadata to environment variables.
Example:
```yaml
rawenv:
  my-podname:
    valueFrom:
      fieldRef:
        fieldPath: metadata.name
```
### Config Maps
```yaml
configmaps:
  my-config-map: # name and filename for the config map
    path: /path/to/mount # path where the configmap shall be mounted
    data: |- # **raw** data for the configmap
     this is raw data
```
### Secrets
```yaml
secrets:
  my-secret:
    path: /path # if specified, mount the secret to this path
    values:
      val1: foo
      val2: bar
  env-secret:
    env: true # if true, mount the values as env variables
    values:
      env-val: foo
      env-val2: bar
```

### Mounting external Volumes or secrets
Allows to mount externally defined volumes, configmaps, secrets and secrets as env variables
```yaml
mounts:
  volumes: # same syntax as volumes but these are just mounted, not created
    my-external-volume: # exact volume name
      path: /my-external-volume
  configmaps:
    my-external-config-map: # exact config map name
      path: /my-external-config-map
  secrets:
    my-external-secret:
      path: /my-external-secret
    my-external-named-secret:
      from: the-secret-name # lets you specify a different name this secret is mounted from
      path: /my-external-secret
  env: # mount secrets as env variables
    MY_ENV_VALUE:
      name: name-of-secret
      key: key-in-secret
```
### Customizing the service name
If a service name is customized it has a 'fixed' hostname

```yaml
service:
    name: my-service
```
### Stateful Set
If you want to create a stateful set instead of a deployment config, set this to true.
```yaml
stateful: true
```
### Headless Service
Allows to define a [headless service](https://kubernetes.io/docs/concepts/services-networking/service/#headless-services).
The ports are specified exactly the same as the ports above.
```yaml
headless:
  name: my-headless-service # name is required. autogenerated headless names make no sense
  ports:
    my-port: # 'name' of the port
      port: 100
      target: 100 # defaults to port

```

### Service Account
If your deployment requires to run under a specific service account, configure this property.
```yaml
serviceaccount: my-account
```

### Readiness and Liveness probe
Needs to be in openshift format.
Don't use a named port here, it doesn't work.

```yaml
readinessProbe:
  httpGet:
    path: /health
    port: 8080

livenessProbe:
  httpGet:
    path: /health
    port: 8080
```

### Redeployments
Strategy for deployments in openshift format.

```yaml
strategy:
  type: Rolling # this is actually the openshift default
```

### Annotations
Specify custom annotations
```yaml
annotations:
  my-annotation: my-value
```
### Pod Affinity
Specify pod affinity.
```yaml
affinity:
  preffered: false # if this is true it will result in a a preferred rule, otherwhise a required one
  anti: false # if this is true, the affinity will actually be an anti affinity
```

### Command and Arguments
Allows you to specify the container command or the arguments.
If you do not specify a command, the args will not be set.

#### Limitations:
* command must be a single executable. Openshift will try to execute the whole command as binary.
``echo 'running'`` would not work as command for example.
* args must be an array.
```yaml
command: echo
args:
  - 'running'
```

### Sidecars

To define a sidecar add a `sidecars` array.
You use the following keys with the same syntax as defined in this document.
**Warning** direct volume/secret/configmap definitions only work if the volumes are defined on the top level.
Using `mounts` instead is advised.

* name
* image and tag
* cpu and memory
* command and args
* readiness and livenes probes
* mounts
* volume/secret/configmap (see the warning above)
```yaml
sidecars:
  my-sidecar:
    image: sidecarimage
    tag: sidecartag
    cpu:
      min: 100m
      max: 1000m
    memory:
      min: 500Mi
      max: 550Mi
```
